<section class="testimonial-slider-section">

  <div class="container">
    
  <div class="testimonial-header">
    
    {% if section.settings.subheading != blank %}
      <p>{{ section.settings.subheading }}</p>
    {% endif %}
    {% if section.settings.heading != blank %}
      <h2>{{ section.settings.heading }}</h2>
    {% endif %}
  </div>  
    
  <div class="custom-testimonials-content">
      
  <div class="testimonials-carousel-custom-img-wrapper">

  <div class="testimonial-image-slider"  id="testimonial-image-slider-{{ section.id }}">
    {% for block in section.blocks %}
      <div class="carousel-cell">
        {% if block.settings.image != blank %}
          <div class="testimonial-image">
            <div class="slider-image-wrap">
             <img class="slider-image"
                srcset="{%- if block.settings.image.width >= 165 -%}{{ block.settings.image | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if block.settings.image.width >= 450 -%}{{ block.settings.image | image_url: width: 450 }} 450w,{%- endif -%}
                {%- if block.settings.image.width >= 750 -%}{{ block.settings.image | image_url: width: 750 }} 750w,{%- endif -%}
                {%- if block.settings.image.width >= 1024 -%}{{ block.settings.image | image_url: width: 1024 }} 1024w,{%- endif -%}
                {%- if block.settings.image.width >= 1200 -%}{{ block.settings.image | image_url: width: 1200 }} 1200w,{%- endif -%}
                {{ block.settings.image | image_url }} {{ block.settings.image.width }}w"
                src="{{ block.settings.image | image_url: width: 750 }}"
                sizes="(min-width: 768px) 300px, 100vw"
                alt="{{ block.settings.author_name | escape }}"
                loading="lazy"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}">
            </div>
          </div>
        {% endif %}
     </div>
    {% endfor %}
    </div>
    </div>

     <div class="testimonials-carousels testimonial-content"  id="testimonial-content-slider-{{ section.id }}">
        {% if section.blocks.size > 0 %}
         {% for block in section.blocks %}
          <div class="carousel-cell">
            <div class="cell-wrapper">
              <ul class="review-star-wrapper">
              {% if block.settings.review_count != blank %}
                {%- assign ratings = block.settings.review_count -%}
                  {% for i in (1..ratings) %}
                      <li class="review-star-list">
                         <svg class="review-star-svg" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" x="0" y="0" viewBox="0 0 406.125 406.125" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M260.133 155.967c-4.487 0-9.25-3.463-10.64-7.73L205.574 13.075c-1.39-4.268-3.633-4.268-5.023 0L156.64 148.237c-1.39 4.268-6.153 7.73-10.64 7.73H3.88c-4.487 0-5.186 2.138-1.553 4.78l114.971 83.521c3.633 2.642 5.454 8.242 4.064 12.51l-43.91 135.154c-1.39 4.268.431 5.592 4.064 2.951l114.971-83.521c3.633-2.642 9.519-2.642 13.152 0l114.971 83.529c3.633 2.642 5.454 1.317 4.064-2.951l-43.911-135.154c-1.39-4.268.431-9.868 4.064-12.51l114.971-83.521c3.633-2.642 2.934-4.78-1.553-4.78H260.133v-.008z" style="" fill="#ffb503" data-original="#ffb503" class=""></path></g></svg>
                      </li>
                  {% endfor %}
              {% endif %}
              </ul>
              {% if block.settings.feedback != blank %}
                <div class="feedback"> {{  block.settings.feedback  }}</div>
              {% endif %}
              {% if block.settings.author != blank %}
                <p class="author"> - {{ block.settings.author }}</p>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        {% endif %}
        </div>
    
    
    </div>
  </div>

    
</section>


<style>

.testimonial-slider .carousel-cell  {
  width: 20%;
}

.testimonial-slider:focus-visible {
  outline: 0;
  outline-offset: 0;
  box-shadow: none;
} 

.testimonial-slider-section .container {
  max-width: 1024px;
  margin: 0 auto;
  padding: 0 20px;
}

.testimonial-slider-section {
  text-align: center;
  padding: 50px 20px;
  background: #f5f5f0;
  font-family: sans-serif;
}
  
.testimonial-header p {
  font-size: 14px;
  color: #333;
  margin: 0;
}
  
.testimonial-header h2 {
  font-size: 22px;
  margin-top: 5px;
  font-weight: bold;
}
  
.testimonial-slider {
  margin-top: 30px;
}
  
.testimonial-slide {
  max-width: 700px;
  margin: 0 auto;
}
  
.testimonial-image img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
}
  
.stars {
  font-size: 20px;
  color: #f5b50a;
  margin-bottom: 20px;
}
  
.testimonial-text {
  font-size: 15px;
  line-height: 1.6;
  color: #333;
}
  
.testimonial-author {
  font-style: italic;
  margin-top: 10px;
  color: #666;
}

.carousel-cell .slider-image {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 20px; /* rounded square */
  transition: all 0.3s ease;
}

.carousel-cell.is-selected .slider-image {
  width: 120px;
  height: 120px;
  border-radius: 50%; /* full circle */
  border: 3px solid black;
  padding: 3px;
}

/* Optional - style the side ones */
.carousel-cell.is-next .slider-image,
.carousel-cell.is-previous .slider-image {
  opacity: 0.8;
  transform: scale(0.95);
}
  
 .review-star-wrapper {
    display: flex;
    list-style-type: none;
    padding: 0;
    margin: 0px;
    justify-content: center;
}

 .review-star-svg {
    height: 20px;
    width: auto;
    margin: 0 2px;
}

.testimonial-image-slider .carousel-cell  {
   width: 20%;
}


</style>

  


<script>


$(document).ready(function () {
  
  var $imageCarousel, $contentCarousel;
  var imageFlickity, contentFlickity;

  function updateAdjacentSlides() {
    var $cells = $imageCarousel.find('.carousel-cell');
    var selectedIndex = imageFlickity.selectedIndex;
    var cellCount = imageFlickity.cells.length;

    $cells.removeClass('is-previous is-next');

    var previousIndex = (selectedIndex - 1 + cellCount) % cellCount;
    var nextIndex = (selectedIndex + 1) % cellCount;

    $cells.eq(previousIndex).addClass('is-previous');
    $cells.eq(nextIndex).addClass('is-next');
  }

  function initTestimonialSliders() {
    $imageCarousel = $('#testimonial-image-slider-{{ section.id }}');
    $contentCarousel = $('#testimonial-content-slider-{{ section.id }}');

    // Destroy if exists
    if ($imageCarousel.data('flickity')) {
      $imageCarousel.flickity('destroy');
    }
    if ($contentCarousel.data('flickity')) {
      $contentCarousel.flickity('destroy');
    }

    // Content Carousel (Main)
    contentFlickity = new Flickity($contentCarousel[0], {
      cellAlign: 'center',
      contain: true,
      pageDots: false,
      prevNextButtons: false,
      wrapAround: true,
      draggable: true
    });

    // Image Carousel (as Nav)
    imageFlickity = new Flickity($imageCarousel[0], {
      asNavFor: '#testimonial-content-slider-{{ section.id }}',
      contain: true,
      pageDots: false,
      prevNextButtons: false,
      cellAlign: 'center',
      wrapAround: true,
      draggable: true
    });

    // Update classes
    updateAdjacentSlides();

    imageFlickity.on('change', function () {
      updateAdjacentSlides();
    });
  }

  // Initialize on document ready
  initTestimonialSliders();

  // Reinitialize on resize
  $(window).on('resize', function () {
    initTestimonialSliders();
  });

  // Reinitialize on Shopify section load
  document.addEventListener('shopify:section:load', function (event) {
    if (event.detail.sectionId === '{{ section.id }}') {
      initTestimonialSliders();
    }
  });
});



</script>



<style>
  

  
</style>

{% schema %}
  {
    "name": "Custom Testimonials",
     "disabled_on": {
      "groups": ["header", "footer"]
    },
    "settings": [
      {
        "type": "text",
        "id": "section_title",
        "label": "Heading",
        "default": "LATEST LUXE ADDITIONS"
      },
      {
        "type": "text",
        "id": "section_sub_title",
        "label": "sub Heading",
        "default": "THE PIECES YOU LOVE"
      },
      {
        "type": "range",
        "id": "slide_to_show",
        "label": "Slide to Show",
        "default": 5,
        "min": 3,
        "max": 5,
        "step": 1
      },
    ],
    "blocks": [
      {
        "type": "Feedback",
        "name": "Feedback",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image",
            "info": "Recommended Dimensions: 150x170 pixels."
          },
          {
            "type": "range",
            "id": "review_count",
            "min": 1,
            "max": 5,
            "step": 1,
            "label": "Review",
            "default": 5
          },
          {
            "type": "richtext",
            "id": "feedback",
            "label": "Feedback",
            "default": "<p>The best quality leather for a fraction of the high street price! Iâ€™m on my 3rd bag already, I love them that much.</p>"
          },
          {
            "type": "text",
            "id": "author",
            "label": "Author",
            "default": "Sarah B."
          }
        ]
      }
    ],
    "presets": [
	  {
		"name": "Custom Testimonials"
	  }
	]
  }
{% endschema %}
